<?php $__env->startSection('content'); ?>

<ol class="breadcrumb bc-3">
    <li>
        <a href="<?php echo action('dashboard'); ?>"><i class="entypo-home"></i>Home</a>
    </li>
    <li>

        <a href="<?php echo URL::to('accounts'); ?>">Accounts</a>
    </li>
    <li class="active">
        <strong>New Account</strong>
    </li>
</ol>
<h3>New Account</h3>
<?php echo $__env->make('includes.errors', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<?php echo $__env->make('includes.success', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>

<p style="text-align: right;">
    <button type="button"  class="save btn btn-primary btn-sm btn-icon icon-left" data-loading-text="Loading...">
        <i class="entypo-floppy"></i>
        Save
    </button>

    <a href="<?php echo URL::to('/accounts'); ?>" class="btn btn-danger btn-sm btn-icon icon-left">
        <i class="entypo-cancel"></i>
        Close
    </a>
</p>
<br>
<div class="row">
    <div class="col-md-12">
             <form role="form" id="account-from" method="post" action="<?php echo URL::to('accounts/store'); ?>" class="form-horizontal form-groups-bordered">

            <div class="panel panel-primary" data-collapsed="0">
                <div class="panel-heading">
                    <div class="panel-title">
                        Account Details
                    </div>

                    <div class="panel-options">
                        <a href="#" data-rel="collapse"><i class="entypo-down-open"></i></a>
                    </div>
                </div>

                <div class="panel-body">
                    <div class="form-group">
                        <label for="field-1" class="col-sm-2 control-label">Account Owner</label>
                        <div class="col-sm-4">
                            <?php echo Form::select('Owner',$account_owners,User::get_userID(),array("class"=>"select2")); ?>

                        </div>

                        <label class="col-sm-2 control-label">Ownership</label>
                        <div class="col-sm-4">
                            <?php $ownership_array = array( ""=>"None", "Private"=>"Private" , "Public"=>"Public" ,"Subsidiary"=>"Subsidiary","Other"=>"Other" ); ?>
                            <?php echo Form::select('Ownership', $ownership_array, Input::old('Ownership') ,array("class"=>"form-control")); ?>

                        </div>

                    </div>
                    <div class="form-group">
                        <label for="field-1" class="col-sm-2 control-label">First Name</label>
                        <div class="col-sm-4">
                            <input type="text" name="FirstName" class="form-control" id="field-1" placeholder="" value="<?php echo Input::old('FirstName'); ?>" />
                        </div>

                        <label for="field-1" class="col-sm-2 control-label">Last Name</label>
                        <div class="col-sm-4">
                            <input type="text" name="LastName" class="form-control" id="field-1" placeholder="" value="<?php echo Input::old('LastName'); ?>" />
                        </div>

                    </div>
                    <div class="form-group">
                        <label for="field-1" class="col-sm-2 control-label">Account Number</label>
                        <div class="col-sm-4">
                            <input type="text" name="Number" class="form-control" id="field-1" placeholder="AUTO" value="<?php echo $LastAccountNo; ?>" />
                        </div>

                        <label for="field-1" class="col-sm-2 control-label">Website</label>
                        <div class="col-sm-4">
                            <input type="text" name="Website" class="form-control" id="field-1" placeholder="" value="<?php echo Input::old('Website'); ?>" />
                        </div>

                    </div>
                    <div class="form-group">
                        <label for="field-1" class="col-sm-2 control-label">*Account Name</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" name="AccountName" data-validate="required" data-message-required="This is custom message for required field." id="field-1" placeholder="" value="<?php echo Input::old('AccountName'); ?>" />
                        </div>

                        <label for="field-1" class="col-sm-2 control-label">Phone</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control"  name="Phone" id="field-1" placeholder="" value="<?php echo Input::old('Phone'); ?>" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Vendor</label>
                        <div class="col-sm-4">
                            <div class="make-switch switch-small">
                                <input type="checkbox" name="IsVendor"  <?php if(Input::old('IsVendor') == 1 ): ?>checked=""<?php endif; ?> value="1">
                            </div>
                        </div>

                        <label for="field-1" class="col-sm-2 control-label">Fax</label>
                        <div class="col-sm-4">
                            <input type="text" name="Fax" class="form-control" id="field-1" placeholder="" value="<?php echo Input::old('Fax'); ?>" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Customer</label>
                        <div class="col-sm-4">
                            <div class="make-switch switch-small">
                                <input type="checkbox" name="IsCustomer"  <?php if(Input::old('IsCustomer') == 1 ): ?>checked=""<?php endif; ?> value="1">
                            </div>
                        </div>

                        <label for="field-1" class="col-sm-2 control-label">Employee</label>
                        <div class="col-sm-4">
                            <input type="text" name="Employee" class="form-control" id="field-1" placeholder="" value="<?php echo Input::old('Employee'); ?>" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="field-1" class="col-sm-2 control-label">Email</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" name="Email" data-validate="required" data-message-required="" id="field-1" placeholder="" value="<?php echo Input::old('Email'); ?>" />
                        </div>

                        <label for="field-1" class="col-sm-2 control-label">Billing Email</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control"  name="BillingEmail" id="field-1" placeholder="" value="<?php echo Input::old('BillingEmail'); ?>" />
                        </div>

                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">Active</label>
                        <div class="col-sm-4">
                            <div class="make-switch switch-small" >
                                <input type="checkbox" name="Status" checked value="1">
                            </div>
                        </div>

                        <label for="field-1" class="col-sm-2 control-label">VAT Number</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control"  name="VatNumber" id="field-1" placeholder="" value="<?php echo Input::old('VatNumber'); ?>" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Currency</label>
                        <div class="col-sm-4">
                                <?php echo Form::select('CurrencyId', $currencies, '' ,array("class"=>"form-control select2")); ?>

                        </div>

                        <label for="field-1" class="col-sm-2 control-label">Timezone</label>
                        <div class="col-sm-4">
                            <?php echo Form::select('Timezone', $timezones, '' ,array("class"=>"form-control select2")); ?>

                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Verification Status</label>
                        <div class="col-sm-4">
                            <?php echo Form::select('VerificationStatus', Account::$doc_status,Account::NOT_VERIFIED,array("class"=>"selectboxit",'disabled'=>'disabled')); ?>

                             <input type="hidden" class="form-control"  name="VerificationStatus" value="<?php echo Account::NOT_VERIFIED; ?>">
                        </div>
                         <label for="field-1" class="col-sm-2 control-label">Authentication Rule</label>
                        <div class="col-sm-4">
                        <table class="table table-bordered datatable dataTable acountiptable ">
                                                <thead>
                                                <tr>

                                                <th>IP</th><th>Action</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                                </table>
                                                <a class="btn btn-primary  btn-sm btn-icon icon-left add-ip"  href="javascript:;" ><i class="entypo-plus"></i>Add</a>
                            <input type="hidden" class="form-control"  name="AccountIP" id="field-1" placeholder="" value="" />
                        </div>
                    </div>
                    <div class="form-group">
                    <label for="field-1" class="col-sm-2 control-label">Nominal Code</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control"  name="NominalAnalysisNominalAccountNumber" id="field-1" placeholder="" value="<?php echo Input::old('NominalAnalysisNominalAccountNumber'); ?>" />
                    </div>
                    </div>
                    <div class="panel-title desc clear">
                        Description
                    </div>
                    <div class="form-group">
                        <div class="col-sm-12">
                            <textarea class="form-control" name="Description" id="events_log" rows="5" placeholder="Description"><?php echo Input::old('Description'); ?></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-primary" data-collapsed="0">
                            <div class="panel-heading">
                                <div class="panel-title">
                                    Address Information
                                </div>

                                <div class="panel-options">
                                    <a href="#" data-rel="collapse"><i class="entypo-down-open"></i></a>
                                </div>
                            </div>

                            <div class="panel-body">
                                <div class="form-group">
                                    <label for="field-1" class="col-sm-2 control-label">Address Line 1</label>
                                    <div class="col-sm-4">
                                        <input type="text" name="Address1" class="form-control" id="field-1" placeholder="" value="<?php echo Input::old('Address1'); ?>" />
                                    </div>

                                    <label for="field-1" class="col-sm-2 control-label">City</label>
                                    <div class="col-sm-4">
                                        <input type="text" name="City" class="form-control" id="field-1" placeholder="" value="<?php echo Input::old('City'); ?>" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="field-1" class="col-sm-2 control-label">Address Line 2</label>
                                    <div class="col-sm-4">
                                        <input type="text" name="Address2" class="form-control" id="field-1" placeholder="" value="<?php echo Input::old('Address2'); ?>" />
                                    </div>

                                    <label for="field-1" class="col-sm-2 control-label">Post/Zip Code</label>
                                    <div class="col-sm-4">
                                        <input type="text" name="PostCode" class="form-control" id="field-1" placeholder="" value="<?php echo Input::old('PostCode'); ?>" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="field-1" class="col-sm-2 control-label">Address Line 3</label>
                                    <div class="col-sm-4">
                                        <input type="text" name="Address3" class="form-control" id="field-1" placeholder="" value="<?php echo Input::old('Address3'); ?>" />
                                    </div>

                                    <label for=" field-1" class="col-sm-2 control-label">*Country</label>
                                    <div class="col-sm-4">

                                        <?php echo Form::select('Country', $countries, Input::old('Country') ,array("class"=>"form-control select2")); ?>


                                    </div>
                                </div>
                            </div>
                        </div>
            <div class="panel panel-primary" data-collapsed="0">
                <div class="panel-heading">
                    <div class="panel-title">
                        Billing
                    </div>

                    <div class="panel-options">
                        <a href="#" data-rel="collapse"><i class="entypo-down-open"></i></a>
                    </div>
                </div>

                <div class="panel-body">
                    <div class="form-group">
                        <label for="field-1" class="col-sm-2 control-label">Tax Rate</label>
                        <div class="col-sm-4">
                            <?php echo Form::select('TaxRateId[]', $taxrates, "" ,array("class"=>"form-control select2",'multiple')); ?>

                        </div>
                        <label for="field-1" class="col-sm-2 control-label">Billing Type*</label>
                        <div class="col-sm-4">
                            <?php echo Form::select('BillingType', AccountApproval::$billing_type, '1',array('id'=>'billing_type',"class"=>"selectboxit")); ?>

                        </div>
                    </div>
                    <div class="form-group">
                        <label for="field-1" class="col-sm-2 control-label">Timezone*</label>
                        <div class="col-sm-4">
                            <?php echo Form::select('BillingTimezone', $timezones, CompanySetting::getKeyVal('BillingTimezone') ,array("class"=>"form-control select2")); ?>

                        </div>
                    <label for="field-1" class="col-sm-2 control-label">Send Invoice via Email</label>
                        <div class="col-sm-4">
                            <?php $SendInvoiceSetting = array(""=>"Please Select an Option", "automatically"=>"Automatically", "after_admin_review"=>"After Admin Review" , "never"=>"Never");?>
                            <?php echo Form::select('SendInvoiceSetting', $SendInvoiceSetting, "never" ,array("class"=>"form-control select2")); ?>

                        </div>
                    </div>
                    <div class="form-group">
                        <label for="field-1" class="col-sm-2 control-label">Payment is expected within (Days)</label>
                        <div class="col-sm-4">
                            <div class="input-spinner">
                                <button type="button" class="btn btn-default">-</button>
                                <?php echo Form::text('PaymentDueInDays', CompanySetting::getKeyVal('PaymentDueInDays') ,array("class"=>"form-control","data-min"=>0, "maxlength"=>"2", "data-max"=>30,"Placeholder"=>"Add Numeric value", "data-mask"=>"decimal")); ?>

                                <button type="button" class="btn btn-default">+</button>
                            </div>

                        </div>
                        <label for="field-1" class="col-sm-2 control-label">Round Charged Amount (123.45) </label>
                        <div class="col-sm-4">
                            <div class="input-spinner">
                                <button type="button" class="btn btn-default">-</button>
                                <?php echo Form::text('RoundChargesAmount', CompanySetting::getKeyVal('RoundChargesAmount') ,array("class"=>"form-control", "maxlength"=>"1", "data-min"=>0,"data-max"=>4,"Placeholder"=>"Add Numeric value" , "data-mask"=>"decimal")); ?>

                                <button type="button" class="btn btn-default">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="field-1" class="col-sm-2 control-label">Billing cycle</label>
                        <div class="col-sm-4">
                            <?php $BillingCycleType = array( ""=>"Please Select an Option","weekly"=>"Weekly", "monthly"=>"Monthly" , "daily"=>"Daily", "in_specific_days"=>"In Specific days", "monthly_anniversary"=>"Monthly anniversary");?>
                            <?php echo Form::select('BillingCycleType', $BillingCycleType, CompanySetting::getKeyVal('BillingCycleType') ,array("class"=>"form-control select2")); ?>

                        </div>
                        <div id="billing_cycle_weekly" class="billing_options" style="display: none">
                            <label for="field-1" class="col-sm-2 control-label">Billing cycle - Start of Day</label>
                            <div class="col-sm-4">
                                <?php $Days = array( ""=>"Please Start of Day",
                                    "monday"=>"Monday",
                                    "tuesday"=>"Tuesday",
                                    "wednesday"=>"Wednesday",
                                    "thursday"=>"Thursday",
                                    "friday"=>"Friday",
                                    "saturday"=>"Saturday",
                                    "sunday"=>"Sunday");?>
                                <?php echo Form::select('BillingCycleValue',$Days,CompanySetting::getKeyVal('BillingCycleValue')  ,array("class"=>"form-control select2")); ?>

                            </div>
                        </div>
                        <div id="billing_cycle_in_specific_days" class="billing_options" style="display: none">
                        <label for="field-1" class="col-sm-2 control-label">Billing cycle - for Days</label>
                            <div class="col-sm-4">
                                <?php echo Form::text('BillingCycleValue', CompanySetting::getKeyVal('BillingCycleValue') ,array("data-mask"=>"decimal", "data-min"=>1, "maxlength"=>"3", "data-max"=>365, "class"=>"form-control","Placeholder"=>"Enter Billing Days")); ?>

                            </div>
                        </div>
                        <div id="billing_cycle_subscription" class="billing_options" style="display: none">
                        <label for="field-1" class="col-sm-2 control-label">Billing cycle - Subscription Qty</label>
                            <div class="col-sm-4">
                                <?php echo Form::text('BillingCycleValue', CompanySetting::getKeyVal('BillingCycleValue') ,array("data-mask"=>"decimal", "data-min"=>1, "maxlength"=>"3", "data-max"=>365, "class"=>"form-control","Placeholder"=>"Enter Subscription Qty")); ?>

                            </div>
                        </div>
                        <div id="billing_cycle_monthly_anniversary" class="billing_options" style="display: none">
                            <label for="field-1" class="col-sm-2 control-label">Billing cycle - Monthly Anniversary Date</label>
                            <div class="col-sm-4">
                                <?php echo Form::text('BillingCycleValue', CompanySetting::getKeyVal('BillingCycleValue') ,array("class"=>"form-control datepicker","Placeholder"=>"Anniversary Date" , "data-start-date"=>"" ,"data-date-format"=>"dd-mm-yyyy", "data-end-date"=>"+1w", "data-start-view"=>"2")); ?>

                            </div>
                        </div>
                    </div>

                <div class="form-group">
                        <label for="field-1" class="col-sm-2 control-label">Invoice Format</label>
                        <div class="col-sm-4">
                            <?php echo Form::select('CDRType', Account::$cdr_type, CompanySetting::getKeyVal('CDRType'),array("class"=>"selectboxit")); ?>

                        </div>
                        <label for="field-1" class="col-sm-2 control-label">Billing Start Date</label>
                         <div class="col-sm-4">   
                            <?php echo Form::text('BillingStartDate',date('Y-m-d',strtotime($BillingStartDate)),array('class'=>'form-control datepicker',"data-date-format"=>"yyyy-mm-dd")); ?>

                         </div>   
                </div>
                <div class="form-group">
                        <label for="field-1" class="col-sm-2 control-label">Invoice Template</label>
                        <div class="col-sm-4">
                        <?php echo Form::select('InvoiceTemplateID', $InvoiceTemplates,  CompanySetting::getKeyVal('InvoiceTemplateID') ,array("class"=>"form-control select2")); ?>

                        </div>
                </div>
                </div>
                </div>
        </form>
    </div>
</div>


<script type="text/javascript">
    jQuery(document).ready(function ($) {

        $(".save.btn").click(function (ev) {
            $("#account-from").submit();
            $(this).button('Loading');

        });
        $('select[name="BillingCycleType"]').on( "change",function(e){
            var selection = $(this).val();
            $(".billing_options input, .billing_options select").attr("disabled", "disabled");// This is to avoid not posting same name hidden elements
            $(".billing_options").hide();
            console.log(selection);
            switch (selection){
                case "weekly":
                        $("#billing_cycle_weekly").show();
                        $("#billing_cycle_weekly select").removeAttr("disabled");
                        break;
                case "monthly_anniversary":
                        $("#billing_cycle_monthly_anniversary").show();
                        $("#billing_cycle_monthly_anniversary input").removeAttr("disabled");
                        break;
                case "in_specific_days":
                        $("#billing_cycle_in_specific_days").show();
                        $("#billing_cycle_in_specific_days input").removeAttr("disabled");
                        break;
                case "subscription":
                        $("#billing_cycle_subscription").show();
                        $("#billing_cycle_subscription input").removeAttr("disabled");
                        break;
            }
        });
        $('body').on('click', '.delete-ip', function(e) {
            e.preventDefault();
            result = confirm("Are you Sure?");
            if(result){
                $(this).parent().parent('tr').remove();
                var nameIDs = $('table.acountiptable tr td:first-child').map(function () {
                                                                      return this.innerHTML.trim();
                                                                  }).get().join(',');
                $("#account-from [name='AccountIP']").val(nameIDs);
            }
        });
        $('body').on('click', '.add-ip', function(e) {
            $("#addip-modal").modal('show');
        });
        $("#form-addip-modal").submit(function(e){
            e.preventDefault();
            var accoutiphtml = '<tr><td>'+$(this).find("[name='AccountIP']").val()+'</td><td><a class="btn  btn-danger btn-sm btn-icon icon-left delete-ip"  href="javascript:;" ><i class="entypo-cancel"></i>Delete</a></td></tr>';
            $('.acountiptable').children('tbody').append(accoutiphtml);
            var nameIDs = $('table.acountiptable tr td:first-child').map(function () {
                              return this.innerHTML.trim();
                          }).get().join(',');
            $("#account-from [name='AccountIP']").val(nameIDs);
            $('.acountiptable').children('tbody').children('tr').children('td');

            $("#addip-modal").modal('hide');
        });
        $('select[name="BillingCycleType"]').trigger( "change" );
        setTimeout(function(){
            $('select[name="CDRType"]').trigger( "change" );
        },500)

    });
function ajax_form_success(response){
    if(typeof response.redirect != 'undefined' && response.redirect != ''){
        window.location = response.redirect;
    }
 }
</script>
<?php echo $__env->make('includes.ajax_submit_script', array('formID'=>'account-from' , 'url' => 'accounts/store','update_url'=>'accounts/update/{id}' ), array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<?php $__env->stopSection(); ?>
<?php $__env->startSection('footer_ext'); ?>
@parent
<div class="modal fade" id="addip-modal" >
    <div class="modal-dialog">
        <div class="modal-content">
        <form role="form" id="form-addip-modal" method="post" class="form-horizontal form-groups-bordered" enctype="multipart/form-data">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Add IP</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="col-sm-3 control-label">AccountIP</label>
                    <div class="col-sm-5">
                        <input name="AccountIP" type="text" class="form-control">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit"  class="btn btn-primary btn-sm btn-icon icon-left">
                    <i class="entypo-floppy"></i>
                     Add
                </button>
                <button  type="button" class="btn btn-danger btn-sm btn-icon icon-left" data-dismiss="modal">
                     <i class="entypo-cancel"></i>
                     Close
                </button>
             </div>
        </form>
        </div>
    </div>
</div>

<?php $__env->stopSection(); ?>
<?php echo $__env->make('layout.main', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>